function addRandomEpisodeButton() {
    // Check if button already exists
    if (document.getElementById("random-episode-btn")) return;

    // Find the button row (but not inside a preview modal)
    const buttonRow = document.querySelector(".buttonControls--container:not(.has-smaller-buttons)");

    if (!buttonRow) {
        console.log("Button container not found yet, waiting for Netflix UI to load...");
        return;
    }

    console.log("Adding 'Random Episode' button...");

    // Create button
    const randomButton = document.createElement("button");
    randomButton.id = "random-episode-btn";
    randomButton.setAttribute("aria-label", "Random Episode");
    randomButton.classList.add("color-supplementary", "hasIcon", "round", "ltr-1t5n97z");
    randomButton.innerHTML = `<div class="ltr-1st24vv">
                                <div class="small ltr-iyulz3" role="presentation">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                                        <path fill="currentColor" d="M20.25 4.5H8.25C7.25629 4.50277 6.30409 4.89875 5.60144 5.60144C4.89875 6.30409 4.50277 7.25629 4.5 8.25V20.25C4.5 22.3125 6.18753 24 8.25 24H20.25C22.3125 24 24 22.3125 24 20.25V8.25C24 6.18753 22.3125 4.5 20.25 4.5ZM9.75 21C9.15305 20.9998 8.58065 20.7625 8.15869 20.3402C7.73673 19.918 7.49978 19.3454 7.5 18.7485C7.50022 18.1516 7.73755 17.5792 8.15978 17.1572C8.58202 16.7353 9.15458 16.4983 9.75153 16.4985C10.3484 16.4987 10.9208 16.736 11.3428 17.1583C11.7647 17.5805 12.0017 18.1531 12.0015 18.75C12.0013 19.3469 11.764 19.9193 11.3417 20.3413C10.9195 20.7633 10.3469 21.0002 9.75 21ZM9.75 12C9.15305 11.9998 8.58065 11.7625 8.15869 11.3402C7.73673 10.918 7.49978 10.3454 7.5 9.74847C7.50022 9.15158 7.73755 8.57918 8.15978 8.15722C8.58202 7.73525 9.15458 7.49831 9.75153 7.49853C10.3484 7.49869 10.9208 7.73602 11.3428 8.15826C11.7647 8.58049 12.0017 9.15305 12.0015 9.75C12.0013 10.3469 11.764 10.9193 11.3417 11.3413C10.9195 11.7633 10.3469 12.0002 9.75 12ZM14.25 16.5C13.9544 16.4999 13.6618 16.4416 13.3887 16.3284C13.1157 16.2152 12.8677 16.0493 12.6587 15.8402C12.2367 15.418 11.9998 14.8454 12 14.2485C12.0001 13.9529 12.0584 13.6603 12.1716 13.3873C12.2848 13.1142 12.4507 12.8661 12.6598 12.6572C13.082 12.2353 13.6546 11.9983 14.2515 11.9985C14.8484 11.9987 15.4208 12.236 15.8428 12.6583C16.2647 13.0805 16.5017 13.6531 16.5015 14.25C16.5013 14.8469 16.264 15.4193 15.8417 15.8413C15.4195 16.2633 14.8469 16.5002 14.25 16.5ZM18.75 21C18.1531 20.9998 17.5807 20.7625 17.1587 20.3402C16.7367 19.918 16.4998 19.3454 16.5 18.7485C16.5002 18.1516 16.7375 17.5792 17.1598 17.1572C17.582 16.7353 18.1546 16.4983 18.7515 16.4985C19.3484 16.4987 19.9208 16.736 20.3428 17.1583C20.7647 17.5805 21.0017 18.1531 21.0015 18.75C21.0013 19.3469 20.764 19.9193 20.3417 20.3413C19.9195 20.7633 19.3469 21.0002 18.75 21ZM18.75 12C18.1531 11.9998 17.5807 11.7625 17.1587 11.3402C16.7367 10.918 16.4998 10.3454 16.5 9.74847C16.5002 9.15158 16.7375 8.57918 17.1598 8.15722C17.582 7.73525 18.1546 7.49831 18.7515 7.49853C19.3484 7.49869 19.9208 7.73602 20.3428 8.15826C20.7647 8.58049 21.0017 9.15305 21.0015 9.75C21.0013 10.3469 20.764 10.9193 20.3417 11.3413C19.9195 11.7633 19.3469 12.0002 18.75 12ZM19.4235 3C19.2481 2.15452 18.7873 1.39504 18.1185 0.848853C17.4497 0.302669 16.6135 0.0029738 15.75 0H3.75C2.75629 0.00277077 1.80407 0.398749 1.10141 1.10141C0.398749 1.80407 0.00277077 2.75629 0 3.75V15.75C0 17.556 1.293 19.074 3 19.4235V4.5C3 3.675 3.675 3 4.5 3H19.4235Z"/>
                                    </svg>
                                </div>
                              </div>`;

    buttonRow.appendChild(randomButton);
    randomButton.addEventListener("click", pickRandomEpisode);
}

// Function to pick a random episode
async function pickRandomEpisode() {
    console.log("ðŸŽ² Random episode button clicked!");

    // Prevent spam clicking
    const randomButton = document.getElementById("random-episode-btn");
    if (!randomButton) return;
    randomButton.disabled = true; // Disable button temporarily

    // Start Rolling Dice Animation
    const diceFaces = [
        `<path fill="currentColor" d="M2.66667 0H21.3333C22.0406 0 22.7189 0.280951 23.219 0.781048C23.719 1.28115 24 1.95942 24 2.66667V21.3333C24 22.0406 23.719 22.7189 23.219 23.219C22.7189 23.719 22.0406 24 21.3333 24H2.66667C1.95942 24 1.28115 23.719 0.781048 23.219C0.280951 22.7189 0 22.0406 0 21.3333V2.66667C0 1.95942 0.280951 1.28115 0.781048 0.781048C1.28115 0.280951 1.95942 0 2.66667 0ZM12 9.33333C11.2928 9.33333 10.6145 9.61429 10.1144 10.1144C9.61429 10.6145 9.33333 11.2928 9.33333 12C9.33333 12.7072 9.61429 13.3855 10.1144 13.8856C10.6145 14.3857 11.2928 14.6667 12 14.6667C12.7072 14.6667 13.3855 14.3857 13.8856 13.8856C14.3857 13.3855 14.6667 12.7072 14.6667 12C14.6667 11.2928 14.3857 10.6145 13.8856 10.1144C13.3855 9.61429 12.7072 9.33333 12 9.33333Z"/>`,
        `<path fill="currentColor" d="M2.66667 0H21.3333C22.0406 0 22.7189 0.280951 23.219 0.781048C23.719 1.28115 24 1.95942 24 2.66667V21.3333C24 22.0406 23.719 22.7189 23.219 23.219C22.7189 23.719 22.0406 24 21.3333 24H2.66667C1.95942 24 1.28115 23.719 0.781048 23.219C0.280951 22.7189 0 22.0406 0 21.3333V2.66667C0 1.95942 0.280951 1.28115 0.781048 0.781048C1.28115 0.280951 1.95942 0 2.66667 0ZM5.33333 2.66667C4.62609 2.66667 3.94781 2.94762 3.44772 3.44772C2.94762 3.94781 2.66667 4.62609 2.66667 5.33333C2.66667 6.04058 2.94762 6.71885 3.44772 7.21895C3.94781 7.71905 4.62609 8 5.33333 8C6.04058 8 6.71885 7.71905 7.21895 7.21895C7.71905 6.71885 8 6.04058 8 5.33333C8 4.62609 7.71905 3.94781 7.21895 3.44772C6.71885 2.94762 6.04058 2.66667 5.33333 2.66667ZM18.6667 16C17.9594 16 17.2811 16.281 16.781 16.781C16.281 17.2811 16 17.9594 16 18.6667C16 19.3739 16.281 20.0522 16.781 20.5523C17.2811 21.0524 17.9594 21.3333 18.6667 21.3333C19.3739 21.3333 20.0522 21.0524 20.5523 20.5523C21.0524 20.0522 21.3333 19.3739 21.3333 18.6667C21.3333 17.9594 21.0524 17.2811 20.5523 16.781C20.0522 16.281 19.3739 16 18.6667 16Z"/>`,
        `<path fill="currentColor" d="M2.66667 0H21.3333C22.0406 0 22.7189 0.280951 23.219 0.781048C23.719 1.28115 24 1.95942 24 2.66667V21.3333C24 22.0406 23.719 22.7189 23.219 23.219C22.7189 23.719 22.0406 24 21.3333 24H2.66667C1.95942 24 1.28115 23.719 0.781048 23.219C0.280951 22.7189 0 22.0406 0 21.3333V2.66667C0 1.95942 0.280951 1.28115 0.781048 0.781048C1.28115 0.280951 1.95942 0 2.66667 0ZM12 9.33333C11.2928 9.33333 10.6145 9.61429 10.1144 10.1144C9.61429 10.6145 9.33333 11.2928 9.33333 12C9.33333 12.7072 9.61429 13.3855 10.1144 13.8856C10.6145 14.3857 11.2928 14.6667 12 14.6667C12.7072 14.6667 13.3855 14.3857 13.8856 13.8856C14.3857 13.3855 14.6667 12.7072 14.6667 12C14.6667 11.2928 14.3857 10.6145 13.8856 10.1144C13.3855 9.61429 12.7072 9.33333 12 9.33333ZM5.33333 2.66667C4.62609 2.66667 3.94781 2.94762 3.44772 3.44772C2.94762 3.94781 2.66667 4.62609 2.66667 5.33333C2.66667 6.04058 2.94762 6.71885 3.44772 7.21895C3.94781 7.71905 4.62609 8 5.33333 8C6.04058 8 6.71885 7.71905 7.21895 7.21895C7.71905 6.71885 8 6.04058 8 5.33333C8 4.62609 7.71905 3.94781 7.21895 3.44772C6.71885 2.94762 6.04058 2.66667 5.33333 2.66667ZM18.6667 16C17.9594 16 17.2811 16.281 16.781 16.781C16.281 17.2811 16 17.9594 16 18.6667C16 19.3739 16.281 20.0522 16.781 20.5523C17.2811 21.0524 17.9594 21.3333 18.6667 21.3333C19.3739 21.3333 20.0522 21.0524 20.5523 20.5523C21.0524 20.0522 21.3333 19.3739 21.3333 18.6667C21.3333 17.9594 21.0524 17.2811 20.5523 16.781C20.0522 16.281 19.3739 16 18.6667 16Z"/>`,
        `<path fill="currentColor" d="M2.66667 0H21.3333C22.0406 0 22.7189 0.280951 23.219 0.781048C23.719 1.28115 24 1.95942 24 2.66667V21.3333C24 22.0406 23.719 22.7189 23.219 23.219C22.7189 23.719 22.0406 24 21.3333 24H2.66667C1.95942 24 1.28115 23.719 0.781048 23.219C0.280951 22.7189 0 22.0406 0 21.3333V2.66667C0 1.95942 0.280951 1.28115 0.781048 0.781048C1.28115 0.280951 1.95942 0 2.66667 0ZM5.33333 2.66667C4.62609 2.66667 3.94781 2.94762 3.44772 3.44772C2.94762 3.94781 2.66667 4.62609 2.66667 5.33333C2.66667 6.04058 2.94762 6.71885 3.44772 7.21895C3.94781 7.71905 4.62609 8 5.33333 8C6.04058 8 6.71885 7.71905 7.21895 7.21895C7.71905 6.71885 8 6.04058 8 5.33333C8 4.62609 7.71905 3.94781 7.21895 3.44772C6.71885 2.94762 6.04058 2.66667 5.33333 2.66667ZM18.6667 16C17.9594 16 17.2811 16.281 16.781 16.781C16.281 17.2811 16 17.9594 16 18.6667C16 19.3739 16.281 20.0522 16.781 20.5523C17.2811 21.0524 17.9594 21.3333 18.6667 21.3333C19.3739 21.3333 20.0522 21.0524 20.5523 20.5523C21.0524 20.0522 21.3333 19.3739 21.3333 18.6667C21.3333 17.9594 21.0524 17.2811 20.5523 16.781C20.0522 16.281 19.3739 16 18.6667 16ZM18.6667 2.66667C17.9594 2.66667 17.2811 2.94762 16.781 3.44772C16.281 3.94781 16 4.62609 16 5.33333C16 6.04058 16.281 6.71885 16.781 7.21895C17.2811 7.71905 17.9594 8 18.6667 8C19.3739 8 20.0522 7.71905 20.5523 7.21895C21.0524 6.71885 21.3333 6.04058 21.3333 5.33333C21.3333 4.62609 21.0524 3.94781 20.5523 3.44772C20.0522 2.94762 19.3739 2.66667 18.6667 2.66667ZM5.33333 16C4.62609 16 3.94781 16.281 3.44772 16.781C2.94762 17.2811 2.66667 17.9594 2.66667 18.6667C2.66667 19.3739 2.94762 20.0522 3.44772 20.5523C3.94781 21.0524 4.62609 21.3333 5.33333 21.3333C6.04058 21.3333 6.71885 21.0524 7.21895 20.5523C7.71905 20.0522 8 19.3739 8 18.6667C8 17.9594 7.71905 17.2811 7.21895 16.781C6.71885 16.281 6.04058 16 5.33333 16Z"/>`,
        `<path fill="currentColor" d="M2.66667 0H21.3333C22.0406 0 22.7189 0.280951 23.219 0.781048C23.719 1.28115 24 1.95942 24 2.66667V21.3333C24 22.0406 23.719 22.7189 23.219 23.219C22.7189 23.719 22.0406 24 21.3333 24H2.66667C1.95942 24 1.28115 23.719 0.781048 23.219C0.280951 22.7189 0 22.0406 0 21.3333V2.66667C0 1.95942 0.280951 1.28115 0.781048 0.781048C1.28115 0.280951 1.95942 0 2.66667 0ZM5.33333 2.66667C4.62609 2.66667 3.94781 2.94762 3.44772 3.44772C2.94762 3.94781 2.66667 4.62609 2.66667 5.33333C2.66667 6.04058 2.94762 6.71885 3.44772 7.21895C3.94781 7.71905 4.62609 8 5.33333 8C6.04058 8 6.71885 7.71905 7.21895 7.21895C7.71905 6.71885 8 6.04058 8 5.33333C8 4.62609 7.71905 3.94781 7.21895 3.44772C6.71885 2.94762 6.04058 2.66667 5.33333 2.66667ZM18.6667 16C17.9594 16 17.2811 16.281 16.781 16.781C16.281 17.2811 16 17.9594 16 18.6667C16 19.3739 16.281 20.0522 16.781 20.5523C17.2811 21.0524 17.9594 21.3333 18.6667 21.3333C19.3739 21.3333 20.0522 21.0524 20.5523 20.5523C21.0524 20.0522 21.3333 19.3739 21.3333 18.6667C21.3333 17.9594 21.0524 17.2811 20.5523 16.781C20.0522 16.281 19.3739 16 18.6667 16ZM18.6667 2.66667C17.9594 2.66667 17.2811 2.94762 16.781 3.44772C16.281 3.94781 16 4.62609 16 5.33333C16 6.04058 16.281 6.71885 16.781 7.21895C17.2811 7.71905 17.9594 8 18.6667 8C19.3739 8 20.0522 7.71905 20.5523 7.21895C21.0524 6.71885 21.3333 6.04058 21.3333 5.33333C21.3333 4.62609 21.0524 3.94781 20.5523 3.44772C20.0522 2.94762 19.3739 2.66667 18.6667 2.66667ZM12 9.33333C11.2928 9.33333 10.6145 9.61429 10.1144 10.1144C9.61429 10.6145 9.33333 11.2928 9.33333 12C9.33333 12.7072 9.61429 13.3855 10.1144 13.8856C10.6145 14.3857 11.2928 14.6667 12 14.6667C12.7072 14.6667 13.3855 14.3857 13.8856 13.8856C14.3857 13.3855 14.6667 12.7072 14.6667 12C14.6667 11.2928 14.3857 10.6145 13.8856 10.1144C13.3855 9.61429 12.7072 9.33333 12 9.33333ZM5.33333 16C4.62609 16 3.94781 16.281 3.44772 16.781C2.94762 17.2811 2.66667 17.9594 2.66667 18.6667C2.66667 19.3739 2.94762 20.0522 3.44772 20.5523C3.94781 21.0524 4.62609 21.3333 5.33333 21.3333C6.04058 21.3333 6.71885 21.0524 7.21895 20.5523C7.71905 20.0522 8 19.3739 8 18.6667C8 17.9594 7.71905 17.2811 7.21895 16.781C6.71885 16.281 6.04058 16 5.33333 16Z"/>`,
        `<path fill="currentColor" d="M2.66667 0H21.3333C22.0406 0 22.7189 0.280951 23.219 0.781048C23.719 1.28115 24 1.95942 24 2.66667V21.3333C24 22.0406 23.719 22.7189 23.219 23.219C22.7189 23.719 22.0406 24 21.3333 24H2.66667C1.95942 24 1.28115 23.719 0.781048 23.219C0.280951 22.7189 0 22.0406 0 21.3333V2.66667C0 1.95942 0.280951 1.28115 0.781048 0.781048C1.28115 0.280951 1.95942 0 2.66667 0ZM5.33333 2.66667C4.62609 2.66667 3.94781 2.94762 3.44772 3.44772C2.94762 3.94781 2.66667 4.62609 2.66667 5.33333C2.66667 6.04058 2.94762 6.71885 3.44772 7.21895C3.94781 7.71905 4.62609 8 5.33333 8C6.04058 8 6.71885 7.71905 7.21895 7.21895C7.71905 6.71885 8 6.04058 8 5.33333C8 4.62609 7.71905 3.94781 7.21895 3.44772C6.71885 2.94762 6.04058 2.66667 5.33333 2.66667ZM18.6667 16C17.9594 16 17.2811 16.281 16.781 16.781C16.281 17.2811 16 17.9594 16 18.6667C16 19.3739 16.281 20.0522 16.781 20.5523C17.2811 21.0524 17.9594 21.3333 18.6667 21.3333C19.3739 21.3333 20.0522 21.0524 20.5523 20.5523C21.0524 20.0522 21.3333 19.3739 21.3333 18.6667C21.3333 17.9594 21.0524 17.2811 20.5523 16.781C20.0522 16.281 19.3739 16 18.6667 16ZM18.6667 9.33333C17.9594 9.33333 17.2811 9.61429 16.781 10.1144C16.281 10.6145 16 11.2928 16 12C16 12.7072 16.281 13.3855 16.781 13.8856C17.2811 14.3857 17.9594 14.6667 18.6667 14.6667C19.3739 14.6667 20.0522 14.3857 20.5523 13.8856C21.0524 13.3855 21.3333 12.7072 21.3333 12C21.3333 11.2928 21.0524 10.6145 20.5523 10.1144C20.0522 9.61429 19.3739 9.33333 18.6667 9.33333ZM18.6667 2.66667C17.9594 2.66667 17.2811 2.94762 16.781 3.44772C16.281 3.94781 16 4.62609 16 5.33333C16 6.04058 16.281 6.71885 16.781 7.21895C17.2811 7.71905 17.9594 8 18.6667 8C19.3739 8 20.0522 7.71905 20.5523 7.21895C21.0524 6.71885 21.3333 6.04058 21.3333 5.33333C21.3333 4.62609 21.0524 3.94781 20.5523 3.44772C20.0522 2.94762 19.3739 2.66667 18.6667 2.66667ZM5.33333 9.33333C4.62609 9.33333 3.94781 9.61429 3.44772 10.1144C2.94762 10.6145 2.66667 11.2928 2.66667 12C2.66667 12.7072 2.94762 13.3855 3.44772 13.8856C3.94781 14.3857 4.62609 14.6667 5.33333 14.6667C6.04058 14.6667 6.71885 14.3857 7.21895 13.8856C7.71905 13.3855 8 12.7072 8 12C8 11.2928 7.71905 10.6145 7.21895 10.1144C6.71885 9.61429 6.04058 9.33333 5.33333 9.33333ZM5.33333 16C4.62609 16 3.94781 16.281 3.44772 16.781C2.94762 17.2811 2.66667 17.9594 2.66667 18.6667C2.66667 19.3739 2.94762 20.0522 3.44772 20.5523C3.94781 21.0524 4.62609 21.3333 5.33333 21.3333C6.04058 21.3333 6.71885 21.0524 7.21895 20.5523C7.71905 20.0522 8 19.3739 8 18.6667C8 17.9594 7.71905 17.2811 7.21895 16.781C6.71885 16.281 6.04058 16 5.33333 16Z"/>`
    ];

    const diceIcon = randomButton.querySelector("svg");
    let rollCount = 0;

    // Keep rolling the dice until episode is selected
    const rollInterval = setInterval(() => {
        diceIcon.innerHTML = diceFaces[rollCount % 6]; // Cycle through dice faces
        rollCount++;
    }, 100); // Change every 100ms

    try {
        // Open the season selector
        const seasonDropdownButton = document.querySelector("button.dropdown-toggle");
        if (!seasonDropdownButton) throw new Error("âŒ Season dropdown button not found.");
        seasonDropdownButton.click();
        await new Promise(resolve => setTimeout(resolve, 1000));

        // Select "See All Episodes"
        const seasonOptions = document.querySelectorAll(".episodeSelector-dropdown li[data-uia='dropdown-menu-item']");
        if (seasonOptions.length > 0) {
            seasonOptions[seasonOptions.length - 1].click();
            console.log("Selected 'See All Episodes'");
            await new Promise(resolve => setTimeout(resolve, 2000));
        } else {
            throw new Error("âŒ Could not find 'See All Episodes' option.");
        }

        // Find all episode items
        const episodes = Array.from(document.querySelectorAll(".episode-item"));
        if (episodes.length === 0) throw new Error("âŒ No episodes found.");

        // Pick a random episode
        const randomEpisode = episodes[Math.floor(Math.random() * episodes.length)];
        console.log(`ðŸŽ¯ Clicking on episode ${episodes.indexOf(randomEpisode) + 1}`);

        // Stop dice rolling **right before clicking the episode**
        clearInterval(rollInterval);
        diceIcon.innerHTML = diceFaces[Math.floor(Math.random() * 6)];

        // Click the episode to play it
        randomEpisode.click();
    } catch (error) {
        console.error(error.message);
        clearInterval(rollInterval);
        diceIcon.innerHTML = diceFaces[Math.floor(Math.random() * 6)]; // Stop rolling with a final face
    }

    // Re-enable the button after everything is done
    setTimeout(() => (randomButton.disabled = false), 5000);
}

// MutationObserver: Ensures the button always appears
function observeNetflixChanges() {
    console.log("ðŸ‘€ Watching for Netflix page changes...");
    new MutationObserver(() => {
        console.log("ðŸ”„ Detected Netflix UI change. Checking for button...");
        addRandomEpisodeButton();
    }).observe(document.body, { childList: true, subtree: true });
}

// Start observer & ensure button is added
observeNetflixChanges();
addRandomEpisodeButton();